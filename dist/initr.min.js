/*! Initr - v0.1.0 - 2013-06-21
* https://github.com/mindgruve/initr
* Copyright (c) 2013 Chris Kihneman | Mindgruve; Licensed MIT */
(function(e,n){function t(e,n){this.rootPath=e||"",this.deps=n,this.events={},this.done={},this.getDeps(n)}var i,o;t.prototype.getDeps=function(e){if(!e||!e.length)return i.isDev&&console.log("! Initr - no dependencies passed."),undefined;for(var n=0,t=e.length;t>n;n++)this.getDep(e[n])},t.prototype.getDep=function(n,t){var o,r=this;return n.selector&&(o=e(n.selector),!o.length)?(i.isDev&&console.log("! Initr - selector did not match any elements.",n),undefined):n.validate&&!n.validate(o,n)?(i.isDev&&console.log("! Initr - validate function did not pass.",n),undefined):(!n.src&&!n.deps||t?this.initDep(n,o):this.loadDep(n).done(function(){r.initDep(n,o)}).fail(function(){i.isDev&&console.log("! Initr:error - failed to load dependencies.",n)}),undefined)},t.prototype.loadDep=function(e){var n=e.deps||[];return e.src&&n.push(e.src),t.getScripts(n,this.rootPath)},t.prototype.initDep=function(e,n){return e.type&&o[e.type]?o[e.type].run.call(this,e,n):(e.init?(i.isDev&&console.log("- Initr:anonymous -",e),e.init(n,e)):i.isDev&&console.log("! Initr:error:anonymous - no `init` function.",e),undefined)},t.prototype.on=function(n,i){var o;if(n&&i){n=t.normalizeEventName(n),o=this.events[n],o||(o=e.Callbacks(),this.events[n]=o),o.add(i);var r=this.done[n.split(":")[0]];r&&i.apply(null,r)}},t.prototype.trigger=function(e,n,t){e&&this.events[e]&&this.events[e].fire(n,t)},t.prototype.run=function(e){var n=this.done[e];n&&n[1]&&this.getDep(n[1],!0)},t.prototype.addDone=function(e,n){var t=e.name||e.handle;this.done[t]=[n,e],this.trigger(t+":done",n,e)},t.normalizeEventName=function(n){var t;return n=e.trim(n),t=n.split(":"),1!==t.length&&t[1]||(n=t[0]+":done"),n},t.regHttp=/^https?:\/\//,t.getScripts=function(n,o){var r,s,a,l,d=[];for(o||(o=""),r=0,s=n.length;s>r;r++)a=n[r],t.regHttp.test(a)||(a=o+a),l={type:"GET",url:a,dataType:"script",cache:!0},i.timeout&&(l.timeout=i.timeout),d.push(e.ajax(l));return e.when.apply(null,d)},t.checkHandle=function(e,n,t){return e&&e.handle?n&&n[e.handle]?!0:(i.isDev&&console.log("! Initr:error:"+t+" - handle does not exist on `$.fn`.",e),!1):(i.isDev&&console.log("! Initr:error:"+t+" - no dependency handle.",e),!1)},o={"$.fn":{run:function(o,r){t.checkHandle(o,n.$&&n.$.fn,"$.fn")&&(o.types?r.each(function(){var n=e(this),t=n.data("type")||"default",r=o.types&&o.types[t],s=r||o.defaults?e.extend({},o.defaults,r):{};i.isDev&&console.log("- Initr:run:$.fn - type is `"+t+"` with options",s,o.handle,o),n[o.handle](s)}):(i.isDev&&console.log("- Initr:run:$.fn - no types.",o.handle,o),r[o.handle](o.defaults)),this.addDone(o,r))}},$:{run:function(o){t.checkHandle(o,n.$,"$")&&(i.isDev&&console.log("- Initr:run:$ -",o.handle,o),e[o.handle](o.defaults),this.addDone(o,null))}},app:{run:function(e,o){if(t.checkHandle(e,n.app,"app")){i.isDev&&console.log("- Initr:run:app -",e.handle,e);var r=app[e.handle];r&&r.init&&r.init(o,e),this.addDone(e,o)}}}},i=function(e,n){return new t(e,n)},i.Initr=t,n.initr=i})(jQuery,window);