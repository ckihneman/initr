/*! Initr - v1.0.0 - 2017-05-08
* https://github.com/ckihneman/initr
* Copyright (c) 2017 Chris Kihneman Licensed MIT */
(function(e,t){function n(t,n){this.rootPath=t||"",this.deps=n,this.events={},this.done={},this.preResolved=e.Deferred().resolve().promise(),this.getDeps(n)}var i,o;n.charWait="!",n.prototype.getDeps=function(e){if(!e||!e.length)return i.isDev&&console.log("! Initr - no dependencies passed."),undefined;for(var t=0,n=e.length;n>t;t++)this.getDep(e[t])},n.prototype.getDep=function(t,n){var o,r=this;return t.selector&&(o=e(t.selector),!o.length)?(i.isDev&&console.log("! Initr - selector did not match any elements.",t),undefined):t.validate&&!t.validate(o,t)?(i.isDev&&console.log("! Initr - validate function did not pass.",t),undefined):(t.src&&!n?this.loadDep(t).done(function(){r.initDep(t,o)}).fail(function(){i.isDev&&console.log("! Initr:error - failed to load dependencies.",t)}):this.initDep(t,o),undefined)},n.prototype.loadDep=function(e){var t,o;return!i.isDev&&e.bundle?"string"==typeof e.bundle?n.getScripts([e.bundle],this.rootPath):this.preResolved:"string"==typeof e.src?n.getScripts([e.src],this.rootPath):(t=e.src,o=this.getScriptGroups(t),o?this.loadScriptGroups(o):n.getScripts(t,this.rootPath))},n.prototype.getScriptGroups=function(e){for(var t,i,o,r=[],s=0,l=0,a=e.length;a>l;l++)o=e[l],t=o[0]===n.charWait,r[s]=r[s]||[],r[s].push(t?o.substring(1):o),t&&(i=!0,s+=1),t=!1;return i?r:!1},n.prototype.loadScriptGroups=function(e){for(var t,i,o=0,r=e.length;r>o;o++)i=e[o],t=t?t.then(this.thenCallback(i)):n.getScripts(i,this.rootPath);return t},n.prototype.thenCallback=function(e){var t=this;return function(){return n.getScripts(e,t.rootPath)}},n.prototype.initDep=function(e,t){var n=o[e.type];return e.type&&n?n.run.call(this,e,t,n):(e.init?(i.isDev&&console.log("- Initr:anonymous -",e),e.init(t,e)):i.isDev&&console.log("! Initr:error:anonymous - no `init` function.",e),undefined)},n.prototype.on=function(t,i){var o;if(t&&i){t=n.normalizeEventName(t),o=this.events[t],o||(o=e.Callbacks(),this.events[t]=o),o.add(i);var r=this.done[t.split(":")[0]];r&&i.apply(null,r)}},n.prototype.trigger=function(e,t,n){e&&this.events[e]&&this.events[e].fire(t,n)},n.prototype.run=function(e){var t=this.done[e];t&&t[1]&&this.getDep(t[1],!0)},n.prototype.addDone=function(e,t){var n=e.name||e.handle;this.done[n]=[t,e],e.done&&e.done(t,e),this.trigger(n+":done",t,e)},n.normalizeEventName=function(t){var n;return t=e.trim(t),n=t.split(":"),1!==n.length&&n[1]||(t=n[0]+":done"),t},n.regHttp=/^https?:\/\//;var r={};n.getScripts=function(t,o){var s,l,a,p,d,u=[];for(i.isDev&&console.log("- Initr:getScripts",t),o||(o=""),s=0,l=t.length;l>s;s++)a=t[s],n.regHttp.test(a)||(a=o+a),i.isDisableScriptCache||!r[a]?(p={type:"GET",url:a,dataType:"script",cache:!0},i.timeout&&(p.timeout=i.timeout),d=e.ajax(p),r[a]=d):(i.isDev&&console.log("- Initr:scriptCache Found",a),d=r[a]),u.push(d);return e.when.apply(null,u)},n.checkHandle=function(e,t,n){return e&&e.handle?t&&t[e.handle]?!0:(i.isDev&&console.log("! Initr:error:"+n+" - handle does not exist on `$.fn`.",e),!1):(i.isDev&&console.log("! Initr:error:"+n+" - no dependency handle.",e),!1)},o={"$.fn":{run:function(t,o,r){if(n.checkHandle(t,e&&e.fn,"$.fn")){if(t.types){var s=r.runGroups(t,o);if(s.length){var l=r.getLeftOvers(o,s);i.isDev&&console.log("- Initr:run:$.fn - left over with no types.",t.handle,t,l),l[t.handle](t.defaults)}else i.isDev&&console.log("- Initr:run:$.fn - no types found.",t.handle,t,o),o[t.handle](t.defaults)}else i.isDev&&console.log("- Initr:run:$.fn - no types.",t.handle,t,o),o[t.handle](t.defaults);this.addDone(t,o)}},runGroups:function(t,n){var o,r,s,l=[];for(var a in t.types)o=t.types[a],r=o.initrTypeBySelector||t.defaults&&t.defaults.initrTypeBySelector?n.filter(a):n.filter('[data-type="'+a+'"]'),r.length&&(s=e.extend({},t.defaults,o),i.isDev&&console.log("- Initr:run:$.fn - type is `"+a+"` with options",s,t.handle,t,r),r[t.handle](s),o.initrInit&&o.initrInit(r,t),l.push(r));return l},getLeftOvers:function(t,n){for(var i=0,o=n.length,r=e();o>i;i++)r=e.merge(r,n[i]);return t.not(r)}},$:{run:function(o){n.checkHandle(o,t.$,"$")&&(i.isDev&&console.log("- Initr:run:$ -",o.handle,o),e[o.handle](o.defaults),this.addDone(o,null))}},app:{run:function(e,o){if(n.checkHandle(e,t.app,"app")){i.isDev&&console.log("- Initr:run:app -",e.handle,e);var r=app[e.handle];r&&r.init&&r.init(o,e),this.addDone(e,o)}}}},i=function(e,t){return new n(e,t)},i.Initr=n,i.scriptCache=r,t.initr=i})(jQuery,window);