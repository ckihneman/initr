/*! Initr - v0.1.0 - 2013-06-24
* https://github.com/mindgruve/initr
* Copyright (c) 2013 Chris Kihneman | Mindgruve; Licensed MIT */
(function(e,n){function t(e,n){this.rootPath=e||"",this.deps=n,this.events={},this.done={},this.getDeps(n)}var o,i;t.prototype.getDeps=function(e){if(!e||!e.length)return o.isDev&&console.log("! Initr - no dependencies passed."),undefined;for(var n=0,t=e.length;t>n;n++)this.getDep(e[n])},t.prototype.getDep=function(n,t){var i,r=this;return n.selector&&(i=e(n.selector),!i.length)?(o.isDev&&console.log("! Initr - selector did not match any elements.",n),undefined):n.validate&&!n.validate(i,n)?(o.isDev&&console.log("! Initr - validate function did not pass.",n),undefined):(!n.src&&!n.deps||t?this.initDep(n,i):this.loadDep(n).done(function(){r.initDep(n,i)}).fail(function(){o.isDev&&console.log("! Initr:error - failed to load dependencies.",n)}),undefined)},t.prototype.loadDep=function(e){var n=e.deps||[];return e.src&&n.push(e.src),t.getScripts(n,this.rootPath)},t.prototype.initDep=function(e,n){return e.type&&i[e.type]?i[e.type].run.call(this,e,n):(e.init?(o.isDev&&console.log("- Initr:anonymous -",e),e.init(n,e)):o.isDev&&console.log("! Initr:error:anonymous - no `init` function.",e),undefined)},t.prototype.on=function(n,o){var i;if(n&&o){n=t.normalizeEventName(n),i=this.events[n],i||(i=e.Callbacks(),this.events[n]=i),i.add(o);var r=this.done[n.split(":")[0]];r&&o.apply(null,r)}},t.prototype.trigger=function(e,n,t){e&&this.events[e]&&this.events[e].fire(n,t)},t.prototype.run=function(e){var n=this.done[e];n&&n[1]&&this.getDep(n[1],!0)},t.prototype.addDone=function(e,n){var t=e.name||e.handle;this.done[t]=[n,e],e.done&&e.done(n,e),this.trigger(t+":done",n,e)},t.normalizeEventName=function(n){var t;return n=e.trim(n),t=n.split(":"),1!==t.length&&t[1]||(n=t[0]+":done"),n},t.regHttp=/^https?:\/\//,t.getScripts=function(n,i){var r,s,a,l,d=[];for(i||(i=""),r=0,s=n.length;s>r;r++)a=n[r],t.regHttp.test(a)||(a=i+a),l={type:"GET",url:a,dataType:"script",cache:!0},o.timeout&&(l.timeout=o.timeout),d.push(e.ajax(l));return e.when.apply(null,d)},t.checkHandle=function(e,n,t){return e&&e.handle?n&&n[e.handle]?!0:(o.isDev&&console.log("! Initr:error:"+t+" - handle does not exist on `$.fn`.",e),!1):(o.isDev&&console.log("! Initr:error:"+t+" - no dependency handle.",e),!1)},i={"$.fn":{run:function(i,r){t.checkHandle(i,n.$&&n.$.fn,"$.fn")&&(i.types?r.each(function(){var n=e(this),t=n.data("type")||"default",r=i.types&&i.types[t],s=r||i.defaults?e.extend({},i.defaults,r):{};o.isDev&&console.log("- Initr:run:$.fn - type is `"+t+"` with options",s,i.handle,i),n[i.handle](s)}):(o.isDev&&console.log("- Initr:run:$.fn - no types.",i.handle,i),r[i.handle](i.defaults)),this.addDone(i,r))}},$:{run:function(i){t.checkHandle(i,n.$,"$")&&(o.isDev&&console.log("- Initr:run:$ -",i.handle,i),e[i.handle](i.defaults),this.addDone(i,null))}},app:{run:function(e,i){if(t.checkHandle(e,n.app,"app")){o.isDev&&console.log("- Initr:run:app -",e.handle,e);var r=app[e.handle];r&&r.init&&r.init(i,e),this.addDone(e,i)}}}},o=function(e,n){return new t(e,n)},o.Initr=t,n.initr=o})(jQuery,window);